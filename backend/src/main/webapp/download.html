<!DOCTYPE html>
<html>
<head>
    <title>CESE-Sensors Developers' Page</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
</head>
<body role="document" style="padding-top: 70px;">
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="#">Hello, Endpoints!</a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b
                            class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="https://developers.google.com/appengine/docs/java/">Google App
                            Engine</a></li>
                        <li><a href="https://developers.google.com/appengine/docs/java/endpoints/">Google
                            Cloud Endpoints</a></li>
                        <li>
                            <a href="https://github.com/GoogleCloudPlatform/gradle-appengine-templates/tree/master/HelloEndpoints">Connecting
                                your Android application to this backend</a></li>
                    </ul>
                </li>
                <li><a href="/_ah/api/explorer">Google Cloud Endpoints API Explorer</a></li>
                <li><a href="https://console.developers.google.com">Google Developers Console</a>
                </li>
            </ul>
        </div>
    </div>
</div>

<div class="container theme-showcase" role="main">
    <!--
      Output from Endpoints API call.
    -->
    <div class="alert alert-success" style="visibility: collapse;" id="outputAlert"></div>

    <!--
      A form that takes a text value and submits it to the Endpoint,
      access to the Endpoint is enabled once the client is loaded below.
    -->
    <div class="jumbotron">
        <div class="row">
            <div class="col-lg-12">
                <h1>Howdy World! Hallo Heimur! Servus Mitanand!</h1>

                <p>This is where you hopefully might be able save a CSV-file containing
                    sensor data to a hard-to-get-to bucket.
                    The data will still be safe in the datastore though.</p>

                <form action="putDataToBucket" method="get">
                    <div class="input-group" id="requestForm">
                        <input type="number" id="fromTimestamp" placeholder="fromTimestamp"
                               name="fromTimestamp"
                               autofocus/>
                        <input type="number" id="toTimestamp" placeholder="toTimestamp"
                               name="toTimestamp"/>
                        <input type="password" id="password" placeholder="password"
                               name="password"/>
                        <input type="submit" value="Save Data to Bucket" formmethod="get">
                        <!--In case you wanted to use AJAX <input type="button" onclick="initiateSaving()" value="Save Data to bucket">-->
                    </div>

                </form>

                <p>
                    This button will download all of the data to zipped CSV files in a new folder in
                    Google Cloud Storage. This task executes asynchronously in the Task Queue and
                    will take a long time and consume a lot of resources. Please use only if
                    absolutely necessary.
                </p>
                <ul>
                    <li>Task Queue: <a href="https://console.developers.google.com/appengine/taskqueues/default?project=funfcese&moduleId=default">https://console.developers.google.com/appengine/taskqueues/default?project=funfcese&moduleId=default</a></li>
                    <li>Cloud Storage location: <a href="https://console.developers.google.com/storage/browser/c3s3d4t4dump/?project=funfcese">https://console.developers.google.com/storage/browser/c3s3d4t4dump/?project=funfcese</a></li>
                    <li>Datastore home: <a href="https://console.developers.google.com/datastore/stats?project=funfcese">https://console.developers.google.com/datastore/stats?project=funfcese</a></li>
                    <li>Log files: <a href="https://console.developers.google.com/logs?project=funfcese">https://console.developers.google.com/logs?project=funfcese</a></li>
                </ul>


                <form action="enqueue" method="get">
                    <div class="input-group">
                        <input type="submit" value="Save ALL Data to Bucket" formmethod="get">
                    </div>
                </form>
                <br/>


                <h2>Santa's little helper to calculate timestamps</h2>

                <input type="datetime-local" id="datetime">
                <button onclick="calculateTimestamp()">Get datetime as long</button>
                <p id="timestampResult"></p>
            </div>
        </div>
    </div>
</div>

<script>

    function calculateTimestamp(){
        var input = document.getElementById("datetime").value;
        var dateTime = input.split("T");
        var date = dateTime[0].split("-");
        var time = dateTime[1].split(":");
        var year = date[0];
        var month = date[1]-1;
        var day = date[2];
        var hour = time[0];
        var minute = time[1];

        var result = new Date(year, month, day, hour, minute, 0, 0).getTime();
        document.getElementById("timestampResult").innerHTML = "DateTime as long: "+result;
    }

    function feedback(){alert("I think your request might have been sent. Check at https://console.developers.google.com/project/funfcese/storage/browser");}


    function initiateSaving(){

        var fromTimestamp = getElementById("fromTimestamp").value;
        var toTimestamp = getElementById("toTimestamp").value;
        alert("CALLED");
        var xhttpAJAXthing = new XMLHttpRequest();

        var requestURL = "putStuffToBucket*";



        xhttpAJAXthing.open("GET", requestURL, true);
        xhttpAJAXthing.send();
    }

    function getRequestURL(fromTimestamp, toTimestamp){
        var result = "putStuffToBucket";
        var add1 = "?fromTimestamp=" + fromTimestamp;
        var add2 = "?toTimestamp="   +   toTimestamp;
        result = result.concat(add1,add2);
        return result;
    }

    // This is called initially
    function init() {
      var apiName = 'myApi';
      var apiVersion = 'v1';
      var apiRoot = 'https://' + window.location.host + '/_ah/api';
      if (window.location.hostname == 'localhost'
          || window.location.hostname == '127.0.0.1'
          || ((window.location.port != "") && (window.location.port > 1023))) {
            // We're probably running against the DevAppServer
            apiRoot = 'http://' + window.location.host + '/_ah/api';
      }
      var callback = function() {
        enableClick();
      }
      gapi.client.load(apiName, apiVersion, callback, apiRoot);
    }







</script>
<!--
 Load the Google APIs Client Library for JavaScript
 More info here : https://developers.google.com/api-client-library/javascript/reference/referencedocs
-->

<script src="https://apis.google.com/js/client.js?onload=init"></script>
</body>
</html>